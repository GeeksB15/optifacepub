import{_ as z,L as A,O as G,P as $,o as D,c as J,w as B,a as N,ad as K,p as y,D as X,j as W,l as P,f as Z,t as V,ac as ee}from"./index.8f4630be.js";import{f as Y,c as te}from"./camera_utils.5d4ce010.js";import{c as q}from"./_commonjsHelpers.b8add541.js";var Q={};(function(){function T(e){var n=0;return function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}}}var I=typeof Object.defineProperties=="function"?Object.defineProperty:function(e,n,t){return e==Array.prototype||e==Object.prototype||(e[n]=t.value),e};function s(e){e=[typeof globalThis=="object"&&globalThis,e,typeof window=="object"&&window,typeof self=="object"&&self,typeof q=="object"&&q];for(var n=0;n<e.length;++n){var t=e[n];if(t&&t.Math==Math)return t}throw Error("Cannot find global object")}var S=s(this);function o(e,n){if(n)e:{var t=S;e=e.split(".");for(var r=0;r<e.length-1;r++){var i=e[r];if(!(i in t))break e;t=t[i]}e=e[e.length-1],r=t[e],n=n(r),n!=r&&n!=null&&I(t,e,{configurable:!0,writable:!0,value:n})}}function p(e){var n=typeof Symbol!="undefined"&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:T(e)}}var _=typeof Object.assign=="function"?Object.assign:function(e,n){for(var t=1;t<arguments.length;t++){var r=arguments[t];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};o("Object.assign",function(e){return e||_}),o("Array.prototype.fill",function(e){return e||function(n,t,r){var i=this.length||0;for(0>t&&(t=Math.max(0,i+t)),(r==null||r>i)&&(r=i),r=Number(r),0>r&&(r=Math.max(0,i+r)),t=Number(t||0);t<r;t++)this[t]=n;return this}});function c(e){return e||Array.prototype.fill}o("Int8Array.prototype.fill",c),o("Uint8Array.prototype.fill",c),o("Uint8ClampedArray.prototype.fill",c),o("Int16Array.prototype.fill",c),o("Uint16Array.prototype.fill",c),o("Int32Array.prototype.fill",c),o("Uint32Array.prototype.fill",c),o("Float32Array.prototype.fill",c),o("Float64Array.prototype.fill",c);var R=this||self;function g(e,n){e=e.split(".");var t=R;e[0]in t||typeof t.execScript=="undefined"||t.execScript("var "+e[0]);for(var r;e.length&&(r=e.shift());)e.length||n===void 0?t[r]&&t[r]!==Object.prototype[r]?t=t[r]:t=t[r]={}:t[r]=n}var L={color:"white",lineWidth:4,radius:6,visibilityMin:.5};function x(e){return e=e||{},Object.assign({},L,{fillColor:e.color},e)}function h(e,n){return e instanceof Function?e(n):e}function E(e,n,t){return Math.max(Math.min(n,t),Math.min(Math.max(n,t),e))}g("clamp",E),g("drawLandmarks",function(e,n,t){if(n){t=x(t),e.save();var r=e.canvas,i=0;n=p(n);for(var a=n.next();!a.done;a=n.next())if(a=a.value,a!==void 0&&(a.visibility===void 0||a.visibility>t.visibilityMin)){e.fillStyle=h(t.fillColor,{index:i,from:a}),e.strokeStyle=h(t.color,{index:i,from:a}),e.lineWidth=h(t.lineWidth,{index:i,from:a});var u=new Path2D;u.arc(a.x*r.width,a.y*r.height,h(t.radius,{index:i,from:a}),0,2*Math.PI),e.fill(u),e.stroke(u),++i}e.restore()}}),g("drawConnectors",function(e,n,t,r){if(n&&t){r=x(r),e.save();var i=e.canvas,a=0;t=p(t);for(var u=t.next();!u.done;u=t.next()){var v=u.value;e.beginPath(),u=n[v[0]],v=n[v[1]],u&&v&&(u.visibility===void 0||u.visibility>r.visibilityMin)&&(v.visibility===void 0||v.visibility>r.visibilityMin)&&(e.strokeStyle=h(r.color,{index:a,from:u,to:v}),e.lineWidth=h(r.lineWidth,{index:a,from:u,to:v}),e.moveTo(u.x*i.width,u.y*i.height),e.lineTo(v.x*i.width,v.y*i.height)),++a,e.stroke()}e.restore()}}),g("drawRectangle",function(e,n,t){t=x(t),e.save();var r=e.canvas;e.beginPath(),e.lineWidth=h(t.lineWidth,{}),e.strokeStyle=h(t.color,{}),e.fillStyle=h(t.fillColor,{}),e.translate(n.xCenter*r.width,n.yCenter*r.height),e.rotate(n.rotation*Math.PI/180),e.rect(-n.width/2*r.width,-n.height/2*r.height,n.width*r.width,n.height*r.height),e.translate(-n.xCenter*r.width,-n.yCenter*r.height),e.stroke(),e.fill(),e.restore()}),g("lerp",function(e,n,t,r,i){return E(r*(1-(e-n)/(t-n))+i*(1-(t-e)/(t-n)),r,i)})}).call(q);const ne={class:"q-mb-md row items-center"},re={class:"relative q-mb-md"},ie={key:0,class:"q-mb-md"},oe=["src"],ae={key:1,class:"q-mb-md"},le={class:"text-h6"},se={key:2,class:"text-negative q-mt-md"},ce={__name:"RA",setup(T){const I=A(null),s=A(null),S=A(null);let o=null,p=null;const _=A(!1),c=A(""),R=A(""),g=A(""),L=["Heart","Oblong","Oval","Round","Square"];let x=null,h=!1;async function E(){x=new Worker("/optifacepub/assets/onnx-worker.af18dc4e.js"),x.onmessage=d=>{const{type:l,data:m}=d.data;l==="ready"?(h=!0,console.log("\u2705 Worker ONNX listo")):l==="prediction"?g.value=L[m]||"Desconocido":l==="error"&&(console.error("\u274C Worker error:",m),c.value="Error en clasificaci\xF3n.")}}function e(d){let l=1,m=1,C=0,w=0;for(const f of d)f.x<l&&(l=f.x),f.y<m&&(m=f.y),f.x>C&&(C=f.x),f.y>w&&(w=f.y);return{minX:l,minY:m,maxX:C,maxY:w}}async function n(d){if(o.save(),o.clearRect(0,0,s.value.width,s.value.height),o.drawImage(d.image,0,0,s.value.width,s.value.height),!d.multiFaceLandmarks||d.multiFaceLandmarks.length===0){c.value="No se detect\xF3 ninguna cara.",o.restore();return}c.value="";const l=d.multiFaceLandmarks[0];if(Q.drawConnectors(o,l,Y.FACEMESH_TESSELATION,{color:"#C0C0C070",lineWidth:1}),Q.drawLandmarks(o,l,{color:"#FF3030",radius:1}),!h){o.restore();return}const{minX:m,minY:C,maxX:w,maxY:f}=e(l),j=.5;let M=m*s.value.width,k=C*s.value.height,b=(w-m)*s.value.width,F=(f-C)*s.value.height;M=M-b*j/2,k=k-F*j/2,b=b*(1+j),F=F*(1+j),M=Math.max(0,M),k=Math.max(0,k),b=Math.min(s.value.width-M,b),F=Math.min(s.value.height-k,F);const O=document.createElement("canvas");O.width=224,O.height=224;const U=O.getContext("2d");U.drawImage(s.value,M,k,b,F,0,0,224,224),R.value=O.toDataURL();const H=U.getImageData(0,0,224,224);x.postMessage({type:"predict",imageData:H}),o.restore()}const t=new Y.FaceMesh({locateFile:d=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${d}`});t.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t.onResults(n);function r(){_.value=!_.value,c.value="",_.value?i():a()}function i(){p&&p.stop(),p=new te.Camera(I.value,{onFrame:async()=>await t.send({image:I.value}),width:640,height:480}),p.start()}function a(){p&&(p.stop(),p=null),o.clearRect(0,0,s.value.width,s.value.height)}function u(){c.value="",_.value&&(a(),_.value=!1),S.value.click()}function v(d){const l=d.target.files[0];if(!l)return;const m=new FileReader;m.onload=async C=>{const w=new Image;w.src=C.target.result,w.onload=async()=>{const f=document.createElement("canvas");f.width=640,f.height=480,f.getContext("2d").drawImage(w,0,0,640,480),await t.send({image:f})}},m.readAsDataURL(l)}return G(()=>{o=s.value.getContext("2d"),E()}),$(()=>{a(),x&&x.terminate()}),(d,l)=>(D(),J(ee,null,{default:B(()=>[N(K,{class:"flex flex-center column"},{default:B(()=>[l[2]||(l[2]=y("h2",{class:"text-h5 q-mb-md"},"REALIDADE AUMENTADA + Face Shape",-1)),y("div",ne,[N(X,{onClick:r,label:_.value?"Detener AR":"Iniciar AR",color:"primary",class:"q-mr-sm"},null,8,["label"]),N(X,{onClick:u,label:"Cargar Imagen",color:"secondary"}),y("input",{ref_key:"fileInput",ref:S,type:"file",accept:"image/*",onChange:v,style:{display:"none"}},null,544)]),y("div",re,[y("video",{ref_key:"videoEl",ref:I,playsinline:"",muted:"",style:{display:"none"}},null,512),y("canvas",{ref_key:"canvasEl",ref:s,width:"640",height:"480",style:{border:"2px solid #00ffff"}},null,512)]),R.value?(D(),W("div",ie,[l[0]||(l[0]=y("h5",{class:"text-subtitle2"},"Rostro detectado:",-1)),y("img",{src:R.value,width:"112",height:"112",style:{"border-radius":"8px",border:"2px solid cyan"}},null,8,oe)])):P("",!0),g.value?(D(),W("div",ae,[y("p",le,[l[1]||(l[1]=Z("Forma detectada: ")),y("b",null,V(g.value),1)])])):P("",!0),c.value?(D(),W("p",se,V(c.value),1)):P("",!0)]),_:1})]),_:1}))}};var he=z(ce,[["__scopeId","data-v-27661cce"]]);export{he as default};
