import{_ as j,L as v,O as G,o as Q,c as X,w as E,a as F,ad as H,p as m,Z as J,D as S,t as K,ac as U}from"./index.c43ace83.js";import{V as D,S as ee,P as te,W as oe,D as ne,A as ae,a as se,M as B,b as ie}from"./STLLoader.1a9c65b8.js";const ce={class:"row q-gutter-sm q-mb-md"},le={class:"q-mt-md text-left info-box"},s=640,n=480,re=1e3,de=2,fe=.05,ue={__name:"RAOculos",setup(xe){const z=v(null),R=v(null),x=v(null),A=v(""),C=v(!0),L=v(!1);let w,g,P,i,k=new D;const T=[16711680,65280,255,16776960,16711935];let $=0;G(()=>{w=new ee,g=new te(75,s/n,.1,1e3),P=new oe({canvas:R.value,alpha:!0}),P.setSize(s,n);const t=new ne(16777215,1);t.position.set(0,0,1).normalize(),w.add(t);const e=new ae(16777215,.5);w.add(e),I()});function I(){requestAnimationFrame(I),P.render(w,g)}async function O(){const t=new window.FaceMesh({locateFile:o=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${o}`});t.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t.onResults(Z),new window.Camera(z.value,{onFrame:async()=>await t.send({image:z.value}),width:s,height:n}).start(),V()}function V(){new se().load("/models3d/YO_6_53_v2_CANAL_V - YO FA - VERVE.stl",e=>{const o=new B({color:T[0],shininess:100});i=new ie(e,o),e.computeBoundingBox(),e.boundingBox.getSize(k),e.center(),i.scale.setScalar(1),w.add(i);const c=g.fov*(Math.PI/180),a=Math.abs(k.length()/Math.tan(c/2));g.position.set(0,0,a),g.lookAt(new D(0,0,0))})}function q(){!i||($=($+1)%T.length,i.material=new B({color:T[$],shininess:100}))}function N(t){if(!x.value)return;const e=x.value.getContext("2d");if(e.clearRect(0,0,s,n),!(!C.value||!t)){e.fillStyle="cyan";for(let o of t){const c=o.x*s,a=o.y*n;e.beginPath(),e.arc(c,a,1.5,0,2*Math.PI),e.fill()}}}function Y(t){if(W(t),!x.value||!L.value)return;const e=x.value.getContext("2d");if(!e)return;const o=t[10].y*n,c=t[152].y*n,a=o-(c-o)/4.5,r=t[9].y*n,l=t[2].y*n,d=t[152].y*n;e.strokeStyle="lime",e.lineWidth=1.5,[a,r,l,d].forEach(b=>{e.beginPath(),e.moveTo(0,b),e.lineTo(s,b),e.stroke()});const u=r-a,h=l-r,p=d-l,f=u+h+p,_=(u/f*100).toFixed(1),M=(h/f*100).toFixed(1),y=(p/f*100).toFixed(1);e.fillStyle="yellow",e.font="24px monospace",e.fillText(`${_}%`,10,(a+r)/2),e.fillText(`${M}%`,10,(r+l)/2),e.fillText(`${y}%`,10,(l+d)/2)}function W(t){if(!x.value||!L.value)return;const e=x.value.getContext("2d");if(!e)return;const o=t[2].y*n,c=t[13].y*n,a=t[14].y*n,r=t[152].y*n,l=(c+a)/2,d=(a+r)/2;e.strokeStyle="blue",e.lineWidth=1.5,[l,d,o,r].forEach(b=>{e.beginPath(),e.moveTo(0,b),e.lineTo(s,b),e.stroke()});const u=l-o,h=d-l,p=r-d,f=u+h+p,_=(u/f*100).toFixed(1),M=(h/f*100).toFixed(1),y=(p/f*100).toFixed(1);e.fillStyle="blue",e.font="24px monospace",e.fillText(`${_}%`,s-60,(l+o)/2),e.fillText(`${M}%`,s-60,(l+d)/2),e.fillText(`${y}%`,s-60,(d+r)/2)}function Z(t){if(!t.multiFaceLandmarks||t.multiFaceLandmarks.length===0||!i)return;const e=t.multiFaceLandmarks[0],o=e[168],c=e[234],a=e[454];i.position.set((o.x-.5)*s,-(o.y-.5+fe)*n,o.z*re);const r=Math.sqrt((a.x-c.x)**2+(a.y-c.y)**2),l=(c.z+a.z)/2,d=r*s/k.x/(l+1);i.scale.setScalar(d);const u=Math.atan2(a.y-c.y,a.x-c.x);i.rotation.z=-u;const h=(c.x+a.x)/2,p=o.x-h;i.rotation.y=p*de;const f=(c.y+a.y)/2,_=o.y-f,M=o.z-l,y=Math.atan2(_,M)-Math.PI;i.rotation.x=y,A.value=`Nariz: (${i.position.x.toFixed(1)}, ${i.position.y.toFixed(1)}, ${i.position.z.toFixed(1)})
Escala: ${d.toFixed(3)}
Rotaci\xF3n X: ${(y*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Y: ${(i.rotation.y*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Z: ${(u*180/Math.PI).toFixed(1)}\xB0`,N(e),Y(e)}return(t,e)=>(Q(),X(U,null,{default:E(()=>[F(H,{class:"flex flex-center column"},{default:E(()=>[e[2]||(e[2]=m("h2",{class:"text-h5 q-mb-md"},"AR: Gafas STL con MediaPipe",-1)),m("div",{class:"relative q-mb-md",style:J({width:s+"px",height:n+"px"})},[m("video",{ref_key:"videoEl",ref:z,autoplay:"",playsinline:"",muted:"",width:s,height:n,style:{position:"absolute",top:"0",left:"0","z-index":"0"}},null,512),m("canvas",{ref_key:"canvas3d",ref:R,width:s,height:n,style:{position:"absolute",top:"0",left:"0","z-index":"1","pointer-events":"none"}},null,512),m("canvas",{ref_key:"canvasLandmarks",ref:x,width:s,height:n,style:{position:"absolute",top:"0",left:"0","z-index":"2","pointer-events":"none"}},null,512)],4),m("div",ce,[F(S,{label:"Iniciar AR",color:"primary",onClick:O}),F(S,{label:"Mudar cor",color:"secondary",onClick:q}),F(S,{label:"Mostrar/ocultar landmarks",color:"accent",onClick:e[0]||(e[0]=o=>C.value=!C.value)}),F(S,{label:"Mostrar propor\xE7\xF5es",color:"deep-orange",onClick:e[1]||(e[1]=o=>L.value=!L.value)})]),m("pre",le,"  "+K(A.value)+`
        `,1)]),_:1})]),_:1}))}};var me=j(ue,[["__scopeId","data-v-14a3ca22"]]);export{me as default};
