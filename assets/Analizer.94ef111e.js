import{_ as B,L as p,O as E,o as I,c as V,w,a as M,ad as $,p as l,Z as N,D as q,t as O,ac as Y}from"./index.daed1d23.js";import{V as F,S as T,P as Z,W as j,D as Q,a as G,c as W,b as X}from"./STLLoader.1a9c65b8.js";import{f as H,c as J}from"./camera_utils.5d4ce010.js";import"./_commonjsHelpers.b8add541.js";const K={class:"q-mt-md text-left info-box"},i=640,c=480,U=1e3,ee=2,ae=.05,te={__name:"Analizer",setup(ne){const h=p(null),m=p(null),x=p("");let d,r,f,e,u=new F;E(()=>{d=new T,r=new Z(75,i/c,.1,1e3),f=new j({canvas:h.value,alpha:!0}),f.setSize(i,c);const a=new Q(16777215,1);a.position.set(0,0,1).normalize(),d.add(a),_()});function _(){requestAnimationFrame(_),f.render(d,r)}async function S(){const a=new H.FaceMesh({locateFile:n=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${n}`});a.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),a.onResults(L),new J.Camera(m.value,{onFrame:async()=>await a.send({image:m.value}),width:i,height:c}).start(),k()}function k(){new G().load("/models3d/YO_6_53_v2_CANAL_V - YO FA - VERVE.stl",t=>{const n=new W;e=new X(t,n),t.computeBoundingBox(),t.boundingBox.getSize(u),t.center(),e.scale.setScalar(1),d.add(e);const o=r.fov*(Math.PI/180),s=Math.abs(u.length()/Math.tan(o/2));r.position.set(0,0,s),r.lookAt(new F(0,0,0))})}function L(a){if(!a.multiFaceLandmarks||a.multiFaceLandmarks.length===0||!e)return;const t=a.multiFaceLandmarks[0],n=t[168],o=t[234],s=t[454];e.position.set((n.x-.5)*i,-(n.y-.5+ae)*c,n.z*U);const A=Math.sqrt((s.x-o.x)**2+(s.y-o.y)**2),v=(o.z+s.z)/2,y=A*i/u.x/(v+1);e.scale.setScalar(y);const z=Math.atan2(s.y-o.y,s.x-o.x);e.rotation.z=-z;const P=(o.x+s.x)/2,R=n.x-P;e.rotation.y=R*ee;const b=(o.y+s.y)/2,C=n.y-b,D=n.z-v,g=Math.atan2(C,D)-Math.PI;e.rotation.x=g,x.value=`Nariz: (${e.position.x.toFixed(1)}, ${e.position.y.toFixed(1)}, ${e.position.z.toFixed(1)})
Escala: ${y.toFixed(3)}
Rotaci\xF3n X: ${(g*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Y: ${(e.rotation.y*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Z: ${(z*180/Math.PI).toFixed(1)}\xB0`}return(a,t)=>(I(),V(Y,null,{default:w(()=>[M($,{class:"flex flex-center column"},{default:w(()=>[t[0]||(t[0]=l("h2",{class:"text-h5 q-mb-md"},"AR: Gafas STL con MediaPipe",-1)),l("div",{class:"relative q-mb-md",style:N({width:i+"px",height:c+"px"})},[l("video",{ref_key:"videoEl",ref:m,autoplay:"",playsinline:"",muted:"",width:i,height:c,style:{position:"absolute",top:"0",left:"0","z-index":"0"}},null,512),l("canvas",{ref_key:"canvas3d",ref:h,width:i,height:c,style:{position:"absolute",top:"0",left:"0","z-index":"1","pointer-events":"none"}},null,512)],4),M(q,{label:"Iniciar AR",color:"primary",onClick:S}),l("pre",K,"  "+O(x.value)+`
        `,1)]),_:1})]),_:1}))}};var re=B(te,[["__scopeId","data-v-5f66ef7e"]]);export{re as default};
